<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>zui by zbfe</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style type="text/css">
    html {
        background-color: #fff; 
    }
    </style>
    <script src="lib/requirejs/require.js"></script>
    <script src="lib/requirejs/config.js"></script>
</head>
<body>
    <div class="log">loading...</div>
    <script type="text/javascript">
        var queryUrl = function(name, url) {
            url = url ? (url.indexOf("?") > -1 ? url.substr(url.indexOf("?") + 1) : url) : location.search.substr(1);
            var results;
            if (name) {
                results = url.match(new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"));
                results = results === null ? "" : decodeURIComponent(results[2]);
            } else {
                results = {};
                if (url) {
                    var params = url.split('&'),
                        qrs2,
                        i = 0,
                        len = params.length;
                    for (i = 0; i < len; i++) {
                        qrs2 = params[i].split('=');
                        results[qrs2[0]] = (qrs2[1] === undefined ? '' : decodeURIComponent(qrs2[1]));
                    }
                }
            }
            return results;
        };
        require([
            'zepto'
        ], function () {
            var url = queryUrl('url');
            var index = parseInt(queryUrl('index'), 10) || 0;

            var showError = function (str) {
                $('.log').text(str || '加载出错～')
            };

            if (!url) {
                return showError();
            }

            $.ajax({
                url: url,
                cache: false,
                dataType: 'text',
                success: function (str) {
                    var i = 0;
                    var data;

                    String(str || '').replace(/```runhtml([\S\s]+?)```/g, function ($0, $1) {
                        if (i === index) {
                            data = $1;
                        }

                        i += 1;
                    });

                    // 如果没有标签
                    if (!data) {
                        return showError('标签获取失败');
                    }

                    $('.log').html(data);
                },
                error: function () {
                    showError();
                }
            });
        });
    </script>
</body>
</html>